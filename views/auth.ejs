<div class="auth-container">
	<div class="auth-card">
		<% if (activeTab === 'login') { %>
		<div id="login-section">
			<h2 class="section-title" style="margin-bottom: 24px; font-size: 2rem">
				Welcome Back
			</h2>

			<% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
			<div class="errors">
				<ul>
					<% errors.forEach(function(err) { %>
					<li><%= err.msg %></li>
					<% }); %>
				</ul>
			</div>
			<% } %> <% if (typeof successMessage !== 'undefined' && successMessage) { %>
			<div class="success">
				<p><%= successMessage %></p>
			</div>
			<% } %>

			<form action="/login" method="POST" class="form-auth">
				<div class="field">
					<label for="login-email">Email</label>
					<input
						type="email"
						id="login-email"
						name="email"
						value="<%= (typeof data !== 'undefined' && data.email) ? data.email : '' %>"
						required />
				</div>

				<div class="field">
					<label for="login-password">Password</label>
					<input
						type="password"
						id="login-password"
						name="password"
						required />
				</div>

				<button type="submit" class="btn" style="width: 100%; margin-top: 16px">
					Sign In
				</button>
			</form>

			<p class="link-alt" style="text-align: center; margin-top: 24px">
				Don't have an account? <a href="/register">Register here</a>
			</p>
		</div>
		<% } %>

		<% if (activeTab === 'register') { %>
		<div id="register-section">
			<h2 class="section-title" style="margin-bottom: 24px; font-size: 2rem">
				Create Account
			</h2>

			<% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
			<div class="errors">
				<ul>
					<% errors.forEach(function(err) { %>
					<li><%= err.msg %></li>
					<% }); %>
				</ul>
			</div>
			<% } %>

			<form action="/register" method="POST" class="form-auth">
				<div class="field">
					<label for="reg-name">Name *</label>
					<input
						type="text"
						id="reg-name"
						name="name"
						value="<%= (typeof data !== 'undefined' && data.name) ? data.name : '' %>"
						required />
				</div>

				<div class="field">
					<label for="reg-email">Email *</label>
					<input
						type="email"
						id="reg-email"
						name="email"
						value="<%= (typeof data !== 'undefined' && data.email) ? data.email : '' %>"
						required />
				</div>

				<div class="field">
					<label for="reg-password">Password *</label>
					<input
						type="password"
						id="reg-password"
						name="password"
						required
						minlength="4" />
				</div>

				<div class="field">
					<label for="reg-age">Age *</label>
					<input
						type="number"
						id="reg-age"
						name="age"
						value="<%= (typeof data !== 'undefined' && data.age) ? data.age : '' %>"
						min="1"
						required />
				</div>

				<div class="field">
					<label for="reg-city">City</label>
					<input
						type="text"
						id="reg-city"
						name="city"
						value="<%= (typeof data !== 'undefined' && data.city) ? data.city : '' %>" />
				</div>

				<div class="field">
					<label>Interests</label>
					<div class="checkboxes">
						<% 
							const userInterests = (typeof data !== 'undefined' && data.interests) ? (Array.isArray(data.interests) ? data.interests : [data.interests]) : [];
							const options = [
								{v: 'meditation', l: 'Meditation'},
								{v: 'energy_healing', l: 'Energy Healing'},
								{v: 'chakras', l: 'Chakras'},
								{v: 'astral_journey', l: 'Astral Journey'},
								{v: 'regression_therapy', l: 'Regression Therapy'}
							];
						%>
						<% options.forEach(function(opt) { %>
						<label>
							<input type="checkbox" name="interests" value="<%= opt.v %>" <%=
							userInterests.includes(opt.v) ? 'checked' : '' %> /> <%= opt.l %>
						</label>
						<% }); %>
					</div>
				</div>

				<button type="submit" class="btn" style="width: 100%; margin-top: 16px">
					Register
				</button>
			</form>

			<p class="link-alt" style="text-align: center; margin-top: 24px">
				Already have an account? <a href="/login">Sign in</a>
			</p>
		</div>
		<% } %>
	</div>
</div>

<style>
	.auth-container {
		display: flex;
		justify-content: center;
		padding: 40px 0;
	}
	.auth-card {
		background: var(--card-bg);
		border: 1px solid var(--card-border);
		border-radius: var(--radius-lg);
		padding: 48px;
		backdrop-filter: blur(12px);
		box-shadow: var(--card-shadow);
		width: 100%;
		max-width: 500px;
	}
	.form-auth .field {
		margin-bottom: 20px;
	}
</style>
